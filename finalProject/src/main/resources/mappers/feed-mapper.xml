<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="feedMapper">
  	
  	<insert id="insertBoard">
  	INSERT INTO BOARD(BOARD_NO
  						,ZONE_NO
						,BOARD_WRITER
						,CATEGORY
						,BOARD_CONTENT)
					VALUES(SEQ_BNO.NEXTVAL,
							#{zoneNo},
							#{boardWriter},
							4,
							#{boardContent})
  	</insert>
  	<insert id="insertAttachment">
  	INSERT INTO ATTACHMENT(FILE_NO,BOARD_NO,ORIGIN_NAME,CHANGE_NAME,FILE_PATH,FILE_LEVEL)
  	VALUES(SEQ_FNO.NEXTVAL,SEQ_BNO.CURRVAL,#{originName},#{changeName},#{filePath},2)  	
  	</insert>
  	<select id="selectListCount" resultType="_int">
  		SELECT COUNT(*)
  		FROM BOARD
  		WHERE STATUS = 'Y'
  		AND CATEGORY = 4
  	</select>
  	<select id="selectBoardList" resultMap="feedResultSet">
  		SELECT BOARD_NO,BOARD_WRITER,BOARD_CONTENT,TO_CHAR(CREATE_DATE,'YY/MM/DD HH:MI:SS')"CREATE_DATE",GOOD
		FROM BOARD B
		WHERE STATUS = 'Y'
        AND CATEGORY = 4
		ORDER BY CREATE_DATE DESC
  	</select>
  	
  	<resultMap type="board" id="feedResultSet">
  		<result column="BOARD_NO" property="boardNo"/>
  		<result column="BOARD_WRITER" property="boardWriter"/>
  		<result column="BOARD_CONTENT" property="boardContent"/>
  		<result column="CREATE_DATE" property="createDate"/>
  		<result column="GOOD" property="good"/>
  	</resultMap>
  	
  	<select id="selectAttachmentList" resultMap="attaResultSet">
  		SELECT BOARD_NO,FILE_PATH
        FROM ATTACHMENT 
        WHERE STATUS = 'Y'
        ORDER BY BOARD_NO DESC
  	</select>
  	
  	<resultMap type="Attachment" id="attaResultSet">
  		<result column="BOARD_NO" property="boardNo"/>
  		<result column="FILE_PATH" property="filePath"/>
  	</resultMap>
  	
  	<delete id="deleteBoard" parameterType="int">
  	  DELETE FROM BOARD
  	  WHERE BOARD_NO = #{boardNo}
      AND STATUS = 'Y'
  	</delete>
  	
  	<delete id="deleteAttachment">
  		DELETE FROM ATTACHMENT
  		WHERE BOARD_NO = #{boardNo}
    	AND STATUS = 'Y'
  	</delete>
  	
  	<select id="ckHeart" resultType="_int">
  		SELECT COUNT(*) FROM GOOD
        WHERE BOARD_NO = #{boardNo} 
        AND WRITER = #{writer}
  	</select>
  	
  	<delete id="deleteHeart">
  		DELETE FROM GOOD
  		WHERE BOARD_NO = #{boardNo}
  		AND WRITER = #{writer}
  	</delete>
  	
  	<update id="updateDelete">
  		UPDATE BOARD
		SET GOOD = GOOD-1
		WHERE BOARD_NO = #{boardNo}
		AND STATUS = 'Y'
		AND CATEGORY = 4	
  	</update>
  	
  	<insert id="insertHeart">
  		INSERT INTO GOOD
  		VALUES(#{boardNo},#{writer})
  	</insert>
  	
  	<update id="updateInsert">
  		UPDATE BOARD
  		SET GOOD = GOOD+1
  		WHERE BOARD_NO = #{boardNo}
		AND STATUS = 'Y'
		AND CATEGORY = 4	
  	</update>
  	<select id="selectGood" resultMap="goodResultMap">
  		SELECT BOARD_NO,WRITER
  		FROM GOOD
  	</select>
  	<resultMap type="good" id="goodResultMap">
  		<result column="BOARD_NO" property="boardNo"/>
  		<result column="WRITER" property="writer"/>
  	</resultMap>
  </mapper>